var EWRocketLauncher = function  EWRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWRocketLauncher.prototype = Object.create(Weapon.prototype);
EWRocketLauncher.prototype.constructor =  EWRocketLauncher;

var EWDualRocketLauncher = function  EWDualRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWDualRocketLauncher.prototype = Object.create(Weapon.prototype);
EWDualRocketLauncher.prototype.constructor =  EWDualRocketLauncher;

//var EWGraviticTractingRod = function  EWGraviticTractingRod(json, ship) {
//    Weapon.call(this, json, ship);
//};
//EWGraviticTractingRod.prototype = Object.create(Weapon.prototype);
//EWGraviticTractingRod.prototype.constructor =  EWGraviticTractingRod;

var EWTwinLaserCannon = function  EWTwinLaserCannon(json, ship) {
    Weapon.call(this, json, ship);
};
EWTwinLaserCannon.prototype = Object.create(Weapon.prototype);
EWTwinLaserCannon.prototype.constructor =  EWTwinLaserCannon;

var EWHeavyPointPlasmaGun = function  EWHeavyPointPlasmaGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWHeavyPointPlasmaGun.prototype = Object.create(Weapon.prototype);
EWHeavyPointPlasmaGun.prototype.constructor =  EWHeavyPointPlasmaGun;

var EWParticleGun = function  EWParticleGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWParticleGun.prototype = Object.create(Weapon.prototype);
EWParticleGun.prototype.constructor =  EWParticleGun;

var EWLightParticleGun = function  EWLightParticleGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWLightParticleGun.prototype = Object.create(Weapon.prototype);
EWLightParticleGun.prototype.constructor =  EWLightParticleGun;

var EWParticleLance = function  EWParticleLance(json, ship) {
    Weapon.call(this, json, ship);
};
EWParticleLance.prototype = Object.create(Weapon.prototype);
EWParticleLance.prototype.constructor =  EWParticleLance;

var EWHeavyRocketLauncher = function  EWHeavyRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWHeavyRocketLauncher.prototype = Object.create(Weapon.prototype);
EWHeavyRocketLauncher.prototype.constructor =  EWHeavyRocketLauncher;

var EWRangedHeavyRocketLauncher = function  EWRangedHeavyRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWRangedHeavyRocketLauncher.prototype = Object.create(Weapon.prototype);
EWRangedHeavyRocketLauncher.prototype.constructor =  EWRangedHeavyRocketLauncher;

var EWPointPlasmaGun = function  EWPointPlasmaGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWPointPlasmaGun.prototype = Object.create(Weapon.prototype);
EWPointPlasmaGun.prototype.constructor =  EWPointPlasmaGun;

var EWHeavyPlasmaGun = function  EWHeavyPlasmaGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWHeavyPlasmaGun.prototype = Object.create(Weapon.prototype);
EWHeavyPlasmaGun.prototype.constructor =  EWHeavyPlasmaGun;

var EWLightLaserBeam = function  EWLightLaserBeam(json, ship) {
    Weapon.call(this, json, ship);
};
EWLightLaserBeam.prototype = Object.create(Weapon.prototype);
EWLightLaserBeam.prototype.constructor =  EWLightLaserBeam;

var EWOMissileRack = function  EWOMissileRack(json, ship) {
    MissileLauncher.call(this, json, ship);
};
EWOMissileRack.prototype = Object.create(MissileLauncher.prototype);
EWOMissileRack.prototype.constructor =  EWOMissileRack;

var EWGatlingLaser = function  EWGatlingLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWGatlingLaser.prototype = Object.create(Weapon.prototype);
EWGatlingLaser.prototype.constructor =  EWGatlingLaser;

var EWHeavyGatlingLaser = function  EWHeavyGatlingLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWHeavyGatlingLaser.prototype = Object.create(Weapon.prototype);
EWHeavyGatlingLaser.prototype.constructor =  EWHeavyGatlingLaser;

var EWPlasmaGun = function  EWPlasmaGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWPlasmaGun.prototype = Object.create(Weapon.prototype);
EWPlasmaGun.prototype.constructor =  EWPlasmaGun;

var EWUltralightPlasmaGun = function  EWUltralightPlasmaGun(json, ship) {
    Weapon.call(this, json, ship);
};
EWUltralightPlasmaGun.prototype = Object.create(Weapon.prototype);
EWUltralightPlasmaGun.prototype.constructor =  EWUltralightPlasmaGun;

var EWParticleMaul = function  EWParticleMaul(json, ship) {
    Weapon.call(this, json, ship);
};
EWParticleMaul.prototype = Object.create(Weapon.prototype);
EWParticleMaul.prototype.constructor =  EWParticleMaul;

var EWGatlingParticleBeam = function  EWGatlingParticleBeam(json, ship) {
    Weapon.call(this, json, ship);
};
EWGatlingParticleBeam.prototype = Object.create(Weapon.prototype);
EWGatlingParticleBeam.prototype.constructor =  EWGatlingParticleBeam;

var EWFighterTorpedoLauncher = function  EWFighterTorpedoLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWFighterTorpedoLauncher.prototype = Object.create(Weapon.prototype);
EWFighterTorpedoLauncher.prototype.constructor =  EWFighterTorpedoLauncher;

var EWLightPlasmaMine = function  EWLightPlasmaMine(json, ship) {
    Weapon.call(this, json, ship);
};
EWLightPlasmaMine.prototype = Object.create(Weapon.prototype);
EWLightPlasmaMine.prototype.constructor =  EWLightPlasmaMine;

var EWPlasmaMine = function  EWPlasmaMine(json, ship) {
    Weapon.call(this, json, ship);
};
EWPlasmaMine.prototype = Object.create(Weapon.prototype);
EWPlasmaMine.prototype.constructor =  EWPlasmaMine;

var EWRangedRocketLauncher = function  EWRangedRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWRangedRocketLauncher.prototype = Object.create(Weapon.prototype);
EWRangedRocketLauncher.prototype.constructor =  EWRangedRocketLauncher;

var EWRangedDualRocketLauncher = function  EWRangedDualRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWRangedDualRocketLauncher.prototype = Object.create(Weapon.prototype);
EWRangedDualRocketLauncher.prototype.constructor =  EWRangedDualRocketLauncher;

var EWLightGaussCannon = function  EWLightGaussCannon(json, ship) {
    Weapon.call(this, json, ship);
};
EWLightGaussCannon.prototype = Object.create(Weapon.prototype);
EWLightGaussCannon.prototype.constructor =  EWLightGaussCannon;

var EWPlasmaArc = function  EWPlasmaArc(json, ship) {
    Weapon.call(this, json, ship);
};
EWPlasmaArc.prototype = Object.create(Weapon.prototype);
EWPlasmaArc.prototype.constructor =  EWPlasmaArc;

var EWElectronPolarizer = function  EWElectronPolarizer(json, ship) {
    Weapon.call(this, json, ship);
};
EWElectronPolarizer.prototype = Object.create(Weapon.prototype);
EWElectronPolarizer.prototype.constructor =  EWElectronPolarizer;

var EWEMTorpedo = function  EWEMTorpedo(json, ship) {
    Weapon.call(this, json, ship);
};
EWEMTorpedo.prototype = Object.create(Weapon.prototype);
EWEMTorpedo.prototype.constructor =  EWEMTorpedo;
EWEMTorpedo.prototype.calculateSpecialRangePenalty = function (distance) {
    var distancePenalized = Math.max(0,distance - 20); //ignore first 20 hexes
    var rangePenalty = this.rangePenalty * distancePenalized;
    return rangePenalty;
};

var EWEarlyRailgun = function  EWEarlyRailgun(json, ship) {
    Weapon.call(this, json, ship);
};
EWEarlyRailgun.prototype = Object.create(Weapon.prototype);
EWEarlyRailgun.prototype.constructor =  EWEarlyRailgun;

var EWRangedDualHeavyRocketLauncher = function  EWRangedDualHeavyRocketLauncher(json, ship) {
    Weapon.call(this, json, ship);
};
EWRangedDualHeavyRocketLauncher.prototype = Object.create(Weapon.prototype);
EWRangedDualHeavyRocketLauncher.prototype.constructor =  EWRangedDualHeavyRocketLauncher;

var EWDefenseLaser = function  EWDefenseLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWDefenseLaser.prototype = Object.create(Weapon.prototype);
EWDefenseLaser.prototype.constructor =  EWDefenseLaser;

var EWNuclearTorpedo = function  EWNuclearTorpedo(json, ship) {
    Weapon.call(this, json, ship);
};
EWNuclearTorpedo.prototype = Object.create(Weapon.prototype);
EWNuclearTorpedo.prototype.constructor =  EWNuclearTorpedo;

var EWLaserBolt = function  EWLaserBolt(json, ship) {
    Weapon.call(this, json, ship);
};
EWLaserBolt.prototype = Object.create(Weapon.prototype);
EWLaserBolt.prototype.constructor =  EWLaserBolt;

var EWDualLaserBolt = function  EWDualLaserBolt(json, ship) {
    Weapon.call(this, json, ship);
};
EWDualLaserBolt.prototype = Object.create(Weapon.prototype);
EWDualLaserBolt.prototype.constructor =  EWDualLaserBolt;

var EWRoyalLaser = function  EWRoyalLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWRoyalLaser.prototype = Object.create(Weapon.prototype);
EWRoyalLaser.prototype.constructor =  EWRoyalLaser;

var EWSovereignLaser = function  EWSovereignLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWSovereignLaser.prototype = Object.create(Weapon.prototype);
EWSovereignLaser.prototype.constructor =  EWSovereignLaser;

var EWPulseTorpedo = function  EWPulseTorpedo(json, ship) {
    Weapon.call(this, json, ship);
};
EWPulseTorpedo.prototype = Object.create(Weapon.prototype);

var EWLaserBoltFtr = function  EWLaserBoltFtr(json, ship) {
    Weapon.call(this, json, ship);
};
EWLaserBoltFtr.prototype = Object.create(Weapon.prototype);
EWLaserBoltFtr.prototype.constructor =  EWLaserBoltFtr;

var EWProtoMedLaser = function  EWProtoMedLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWProtoMedLaser.prototype = Object.create(Weapon.prototype);
EWProtoMedLaser.prototype.constructor =  EWProtoMedLaser;

var EWHETLaser = function  EWHETLaser(json, ship) {
    Weapon.call(this, json, ship);
};
EWHETLaser.prototype = Object.create(Weapon.prototype);
EWHETLaser.prototype.constructor =  EWHETLaser;







var EWGraviticTractingRod = function EWGraviticTractingRod(json, ship) {
    Gravitic.call(this, json, ship);
};
EWGraviticTractingRod.prototype = Object.create(Gravitic.prototype);
EWGraviticTractingRod.prototype.constructor = EWGraviticTractingRod;

EWGraviticTractingRod.prototype.calculateSpecialHitChanceMod = function (shooter, target) {
	var mod = 0;

    if(target.gravitic || target.factionAge >= 3) mod = -3; //-15% to hit gravitic and/or Ancient targets.    
    
    if(shooter.team == target.team){
        var distance = mathlib.getDistanceBetweenShipsInHex(shooter, target).toFixed(2);        
        var rangePenalty = weaponManager.calculateRangePenalty(distance, this);
        mod += rangePenalty; //refund range penalty for friendly units since OEW lock on allies not possible.
    }    
    
	return mod; 
};

EWGraviticTractingRod.prototype.initializationUpdate = function() {
    if(gamedata.gamephase == 1 || gamedata.gamephase == 5){ //update weapon data field to show this gravity net's max movement distance or return to TBD
        this.data["Move Distance"] = this.moveDistance;
    } 
    if (this.fireOrders.length > 0) {
        this.hextarget = true;
        this.ignoresLoS = false;

        
    }else{
        this.hextarget = false;
        this.ignoresLoS = false; 
        if(this.target){   
            webglScene.customEvent("RemoveTargetedHexagonInArc", {target: this.target, system: this});
        }                
    } 

    return this;
};

EWGraviticTractingRod.prototype.doMultipleFireOrders = function (shooter, target, system) {
    var shotsOnTarget = 1; //we're only ever allocating one shot at a time for this weapon in Split mode.

    if (this.fireOrders.length > 0) {
        return;
    } 

    var fireOrdersArray = []; // Store multiple fire orders

    for (var s = 0; s < shotsOnTarget; s++) {
        var fireid = shooter.id + "_" + this.id + "_" + (this.fireOrders.length + 1);
        var calledid = -1; //No called shots.     

        var chance = window.weaponManager.calculateHitChange(shooter, target, this, calledid);
        if(chance < 1) continue;

        var fire = {
            id: fireid,
            type: 'prefiring',
            shooterid: shooter.id,
            targetid: target.id,
            weaponid: this.id,
            calledid: calledid,
            turn: gamedata.turn,
            firingMode: this.firingMode,
            shots: 1,
            x: "null",
            y: "null",
            damageclass: 'gravitic', 
            chance: chance,
            hitmod: 0,
            notes: "Split"
        }; 
        this.target = target; //store current target to this gravity net object.       
        fireOrdersArray.push(fire); // Store each fire order
    }

    webglScene.customEvent("ShowTargetedHexagonInArc", {shooter: shooter, target: target, system: this});
    this.hextarget = true; //switch gravNet from shipTarget mode to hexTarget mode.
    
    return fireOrdersArray; // Return all fire orders
};    

EWGraviticTractingRod.prototype.doMultipleHexFireOrders = function (shooter, hexpos) {
    
    var shotsOnTarget = 1; //we're only ever allocating one shot at a time for this weapon in Split mode.

    if (this.fireOrders.length > 1) {
        return;
    }         
    var targetMoveHexValid = this.validateTargetMoveHex(hexpos, this.moveDistance);

    var fireOrdersArray = []; // Store multiple fire orders

    if(targetMoveHexValid){
        for (var s = 0; s < shotsOnTarget; s++) {
                var fireid = shooter.id + "_" + this.id + "_" + (this.fireOrders.length + 1);
                var fire = {
                    id: fireid,
                    type: 'prefiring',
                    shooterid: shooter.id,
                    targetid: -1,
                    weaponid: this.id,
                    calledid: -1,
                    turn: gamedata.turn,
                    firingMode: this.firingMode,
                    shots: this.defaultShots,
                    x: hexpos.q,
                    y: hexpos.r,
                    damageclass: 'tractingRodMoveHex', 
                    notes: "split"                
                };
            fireOrdersArray.push(fire);
        }  
        webglScene.customEvent("RemoveTargetedHexagonInArc", {target: this.target, system: this}); 
    }
    return fireOrdersArray; // Return all fire orders
};  

EWGraviticTractingRod.prototype.validateTargetMoveHex = function(hexpos, maxmoverange){ //function to validate desired target movement hex, will check LOS from target ship to move hex and range and make sure no collisions occur.

    //get gravNetTargetHex to check range and LOS for gravNetTargetMovementHex
    //Target of grav net which will be used as shooter for grav net target hex.
    var valid = false; //default to false
    var tractingRodTargetFireOrder = this.fireOrders[0];//get fireorder of grav net firing ship (So we can use it's hex as fireing hex), this should always be the first fire order
    if (tractingRodTargetFireOrder){	// check that the grav net firing ship set a fire order
        var targetShip = gamedata.getShip(tractingRodTargetFireOrder.targetid);
        var targetShipHex = shipManager.getShipPosition(targetShip);
        var targetMoveHex = hexpos;
        var dist = targetShipHex.distanceTo(targetMoveHex);
        if(dist <= maxmoverange){            
            var blockedHexes = weaponManager.getBlockedHexes();
            var loSBlocked = mathlib.checkLineOfSight(targetShipHex, targetMoveHex, blockedHexes);
            if(!loSBlocked && !blockedHexes.some(blocked => blocked.q === targetMoveHex.q && blocked.r === targetMoveHex.r)){//make sure hexpos is a not a blocked hex and LOS is not blocked      
                valid = true ;  
            }    
        }                 
    }

    return valid;
};             

EWGraviticTractingRod.prototype.checkFinished = function () {
	if(this.fireOrders.length > 1) return true;
    return false;
};